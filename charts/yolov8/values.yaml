# Global settings
# NOTE: These values should be overridden during deployment using --set flags or by editing this file
global:
  domain: example.com  # Change to your domain or override with --set global.domain=yourdomain.com
  subdomain: ml

# Backend configuration
backend:
  replicaCount: 2

  image:
    repository: "" # Will be set by CI/CD or manually
    pullPolicy: Always  # CHANGED: Always pull to avoid cache issues with :latest tag
    tag: "latest"

  service:
    type: ClusterIP
    port: 5000
    targetPort: 5000

  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

  env:
    - name: MODEL_PATH
      value: "yolov8n.pt"
    - name: CONFIDENCE_THRESHOLD
      value: "0.25"
    - name: PORT
      value: "5000"

  livenessProbe:
    httpGet:
      path: /health
      port: 5000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 5000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Frontend configuration
frontend:
  replicaCount: 2

  image:
    repository: "" # Will be set by CI/CD or manually
    pullPolicy: Always  # CHANGED: Always pull to avoid cache issues with :latest tag
    tag: "latest"

  service:
    type: ClusterIP
    port: 3000
    targetPort: 3000

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  env:
    - name: PORT
      value: "3000"
    - name: NODE_ENV
      value: "production"

  livenessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-production"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    # external-dns.alpha.kubernetes.io/hostname: "ml.example.com"  # Will be automatically set from global.subdomain + global.domain
  tls:
    enabled: true
    secretName: yolov8-tls

# HorizontalPodAutoscaler configuration
autoscaling:
  enabled: true
  backend:
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  frontend:
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80

# ServiceAccount
serviceAccount:
  create: true
  annotations: {}
  name: "yolov8"

# PodDisruptionBudget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Security Context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
    - ALL

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
